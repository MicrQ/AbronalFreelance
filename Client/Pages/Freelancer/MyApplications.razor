@page "/my-applications"
<AuthorizeView Roles="Freelancer">
    <Authorized>
<div class="d-xl-flex">
    <!-- Sidebar -->
    <SideBar />
    <!-- Mobile Menu -->
    <MobileMenu />
    <!-- Mobile Menu End -->

    <div class="flex-grow-1 align-items-center">
    <!-- Header -->
    <DashboardHeader />
    <!-- Main -->
    <main class="dashboard-main min-vh-100">
        <div class="d-flex flex-column gap-4">
        <!-- Header -->
        <div
            class="d-flex align-items-md-center flex-column flex-md-row gap-4 justify-content-between"
        >
            <div>
            <h3 class="text-24 fw-bold text-dark-300 mb-2">My Applications</h3>
            <ul class="d-flex align-items-center gap-2">
                <li class="text-dark-200 fs-6">Dashboard</li>
                <li>
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="5"
                    height="11"
                    viewBox="0 0 5 11"
                    fill="none"
                >
                    <path
                    d="M1 10L4 5.5L1 1"
                    stroke="#5B5B5B"
                    stroke-width="1.2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    />
                </svg>
                </li>
                <li class="text-lime-300 fs-6">My Applications</li>
            </ul>
            </div>
        </div>
        <!-- Content -->
        <div>
            <nav>
            <div
                class="d-flex flex-wrap gap-3 align-items-center"
                id="nav-tab"
                role="tablist"
            >
                <button
                class="dashboard-tab-btn active"
                id="nav-all-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-all"
                type="button"
                role="tab"
                aria-controls="nav-all"
                aria-selected="true"
                >
                All(10)
                </button>
                <button
                class="dashboard-tab-btn"
                id="nav-active-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-active"
                type="button"
                role="tab"
                aria-controls="nav-active"
                aria-selected="false"
                >
                Active(4)
                </button>
                <button
                class="dashboard-tab-btn"
                id="nav-empty-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-empty"
                type="button"
                role="tab"
                aria-controls="nav-empty"
                aria-selected="false"
                >
                Empty(0)</button>
                <button
                class="dashboard-tab-btn"
                id="nav-completed-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-completed"
                type="button"
                role="tab"
                aria-controls="nav-completed"
                aria-selected="false"
                >
                Completed(10)</button>
                <button
                class="dashboard-tab-btn"
                id="nav-close-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-close"
                type="button"
                role="tab"
                aria-controls="nav-close"
                aria-selected="false"
                >
                Close Job(5)
                </button>
            </div>
            </nav>
            <!-- Tab Content -->
            <div class="tab-content mt-4" id="nav-tabContent">
            <!-- All -->
            <div
                class="tab-pane fade show active"
                id="nav-all"
                role="tabpanel"
                aria-labelledby="nav-all-tab"
                tabindex="0"
            >
                <!-- My Job -->
                <div class="overflow-x-auto">
                <div class="w-100">
                    <table class="w-100 dashboard-table">
                    <thead class="pb-3">
                        <tr>
                        <th scope="col" class="ps-4">Project Name</th>
                        <th scope="col">Budget</th>
                        <th scope="col">Status</th>
                        <th scope="col">My Offer</th>
                        <th scope="col">Submitted</th>
                        <th scope="col" class="pe-5 text-end">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var app in Apps) {
                            <tr>
                            <td>
                                <div
                                class="d-flex gap-3 align-items-center project-name"
                                >
                                <div class="rounded-3">
                                    <img
                                    src="img/dashboard/projects/1.png"
                                    alt=""
                                    />
                                </div>
                                <div>
                                    <p class="text-dark-200">
                                    @app.JobTitle
                                    </p>
                                </div>
                                </div>
                            </td>
                            <td class="text-dark-200"> ETB @app.JobBudget</td>
                            <td>
                                <span class="status-badge @(Utils.GetStatusColor(app.StatusName))">
                                    @app.StatusName
                                </span>
                            </td>
                            <td class="text-dark-200">
                                ETB @app.Amount
                            </td>
                            <td class="text-dark-200">
                                @(Utils.GetTimeAgo((DateTime)app.CreatedAt))
                            </td>
                            <td>
                                <div class="d-flex justify-content-end gap-2">

                                <a href="my-applications/@app.Id">
                                <button class="dashboard-action-btn">
                                    <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    width="48"
                                    height="48"
                                    viewBox="0 0 48 48"
                                    fill="none"
                                    >
                                    <circle
                                        cx="24"
                                        cy="24"
                                        r="24"
                                        fill="#EDEBE7"
                                    />
                                    <path
                                        d="M34.3187 21.6619C35.6716 23.0854 35.6716 25.248 34.3187 26.6714C32.0369 29.0721 28.1181 32.3333 23.6667 32.3333C19.2152 32.3333 15.2964 29.0721 13.0147 26.6714C11.6618 25.248 11.6618 23.0854 13.0147 21.6619C15.2964 19.2612 19.2152 16 23.6667 16C28.1181 16 32.0369 19.2612 34.3187 21.6619Z"
                                        stroke="#5B5B5B"
                                        stroke-width="1.5"
                                    />
                                    <circle
                                        cx="23.668"
                                        cy="24.167"
                                        r="3.5"
                                        stroke="#5B5B5B"
                                        stroke-width="1.5"
                                    />
                                    </svg>
                                </button>
                                </a>
                                </div>
                            </td>
                            </tr>
                        }
                    </tbody>
                    </table>
                </div>
                </div>
                
            </div>
            <!-- Empty -->
            <div
                class="tab-pane fade"
                id="nav-empty"
                role="tabpanel"
                aria-labelledby="nav-empty-tab"
                tabindex="0"
            >
                <div class="row justify-content-center">
                <div class="col-7">
                    <div>
                    <div
                        class="bg-white p-5 rounded-3 d-flex justify-content-center align-items-center"
                    >
                        <div class="d-flex flex-column align-items-center">
                        <img
                            src="img/dashboard/empty-ill.png"
                            class="img-fluid mb-5"
                            alt=""
                        />
                        <h3 class="text-24 fw-bold text-dark-300 m-2">
                            Order Empty
                        </h3>
                        <p class="fs-6 text-dark-200 text-center">
                            Empty order typically means that the list of items
                            you had previously added has been cleared
                            <span class="text-dark-300">Thank you</span>
                        </p>
                        </div>
                    </div>
                    </div>
                </div>
                </div>
            </div>
            </div>
        </div>
        </div>
    </main>
    </div>
</div>
<LogoutPopUp />
    </Authorized>
    <NotAuthorized>
        401 page
    </NotAuthorized>
</AuthorizeView>


@code {
    private List<ApplicationDTO> Apps = new List<ApplicationDTO>();
    private string LoggedInUserId { get; set; }

    protected override async Task OnInitializedAsync() {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        LoggedInUserId = AccountService.GetLoggedInUserIdAsync(authState).Value;
        Apps = await ApplicationService.GetAllUserApplications(LoggedInUserId);
    }
}